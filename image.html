<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enviar Imagem para API Gemini</title>
</head>

<body>
    <h1>Descrição de Imagem com Gemini</h1>
    <form id="imageForm" enctype="multipart/form-data">
        <input type="file" id="imageInput" accept="image/*">
        <button type="button" onclick="sendImage()">Enviar</button>

    </form>

    <div class="resposta-layer">
        <p id="descricaoTexto"></p>
        <img id="imagemPreview" src="">
    </div>

    <script>
        function sendImage() {
            const inputElement = document.getElementById('imageInput');
            const file = inputElement.files[0];
            const imagemPreview = document.querySelector('#imagemPreview');
            const descricaoTexto = document.querySelector('#descricaoTexto');

            if (!file) {
                alert('Por favor, selecione uma imagem.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (event) {
                const base64ImageFULL = event.target.result;
                const base64Image = event.target.result.split(',')[1]; // Remove o cabeçalho "data:image/jpeg;base64,"

                imagemPreview.src = base64ImageFULL;

                const payload = {
                    "contents": [
                        {
                            "parts": [
                                { "text": "Explique essa imagem para mim e de onde ela veio como se você fosse um critico" },
                                {
                                    "inline_data": {
                                        "mime_type": "image/jpeg",
                                        "data": base64Image
                                    }
                                }
                            ]
                        }
                    ]
                };
                const API_KEY = 'API_KEY'

                fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro-vision:generateContent?key=' + API_KEY, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Resposta da API:', data);
                        descricaoTexto.textContent = data.candidates[0].content.parts[0].text
                        alert('Imagem enviada com sucesso!');
                    })
                    .catch(error => {
                        console.error('Erro ao enviar imagem:', error);
                        alert('Erro ao enviar imagem.');
                    });
            };

            reader.readAsDataURL(file);
        }
    </script>
</body>

</html>